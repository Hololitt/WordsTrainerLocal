<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>users stats</title>
    <link rel="stylesheet" href="/css/dark-theme.css">
    <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #f9f9f9;
    }
    h1 {
      color: #333;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px 15px;
      text-align: left;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f6fc;
    }
    .timestamp {
      margin-top: 15px;
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>

<h1>users stats</h1>

<table id="statsTable">
    <thead>
    <tr>
        <th>username</th>
        <th>total mistakes amount</th>
        <th>language-cards amount</th>
        <th>repetition amount</th>
    </tr>
    </thead>
    <tbody>
    <!-- Данные появятся сюда -->
    </tbody>
</table>

<div class="timestamp" id="lastUpdate">downloading...</div>

<script>
  async function fetchUserStats() {
    try {
      const response = await fetch('/Home/getUsersStats');
      if (!response.ok) throw new Error('Ошибка сети: ' + response.status);
      const data = await response.json();


      const tbody = document.querySelector('#statsTable tbody');
      tbody.innerHTML = ''; // очистить таблицу

      data.usersStats.forEach(user => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${user.username}</td>
          <td>${user.totalMistakesCount}</td>
          <td>${user.countLanguageCards}</td>
          <td>${user.languageCardsRepetitionCount}</td>
        `;

        tbody.appendChild(tr);
      });

      // Вывод времени обновления в удобном формате
      const lastUpdateDiv = document.getElementById('lastUpdate');
      const dt = new Date(data.localDateTime);
      lastUpdateDiv.textContent = 'Последнее обновление: ' + dt.toLocaleString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

    } catch (error) {
      console.error('Ошибка при загрузке статистики:', error);
      document.getElementById('lastUpdate').textContent = 'error loading data';
    }
  }

  fetchUserStats();

  setInterval(fetchUserStats, 60000);
</script>

<a href="/Home/WordsTrainer">Back</a>
<script src="/js/dark-theme-setting.js"></script>

</body>
</html>